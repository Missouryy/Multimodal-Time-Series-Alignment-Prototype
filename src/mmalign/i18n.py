from __future__ import annotations

from typing import Dict


LANGS = {
    "English": {
        "app.title": "Multimodal Time-Series Alignment Prototype",
        "sidebar.header": "",
        "sidebar.upload": "Upload Data",
        "sidebar.upload_help": "Upload file",
        "sidebar.modality": "Modality",
        "sidebar.stream_name": "Stream name",
        "sidebar.add_stream": "Add stream",
        "sidebar.settings": "Settings",
        "sidebar.language": "Language",
        "sidebar.db_status": "Database Status",
        "streams.title": "Streams",
        "streams.select": "Select a stream",
        "streams.overlay_with": "Overlay with",
        "align.title": "Alignment",
        "align.method": "Method",
        "align.rate": "Target rate (Hz)",
        "align.max_lag": "Max lag (s)",
        "align.run": "Run alignment",
        "encode.title": "Feature Encoding",
        "encode.encoder": "Encoder",
        "encode.new_name": "New stream name",
        "post.title": "Analysis & Export",
        "post.download": "Download aligned CSV",
        "post.save_outputs": "Save to outputs/",
        "post.save_db": "Save to database",
        "lang.switch": "Language",
        "method.resample": "Resample",
        "method.xcorr": "Cross-correlation",
        "method.dtw": "DTW",
        "msg.no_adv_enc": "Advanced encoders unavailable (PyTorch/Transformers). Please install dependencies.",
        "msg.upload_hint": "Please upload a file",
        "msg.unsupported_modality": "Unsupported modality",
        "msg.added_stream": "Added {name} ({modality}) with {n} points",
        "msg.failed_to_load": "Failed to load: {err}",
        "msg.need_one_stream_encode": "Please upload at least one stream to encode.",
        "msg.select_stream_to_encode": "Select a stream to encode",
        "msg.no_encoder_selected": "No encoder selected.",
        "ui.advanced_params": "Advanced parameters",
        "ui.num_channels_list": "num_channels list",
        "ui.extract_and_create": "Extract features and create new stream",
        "msg.encoding_success": "Encoded stream {name} added, shape: {shape}",
        "msg.encoding_failed": "Encoding failed: {err}",
        "msg.upload_streams_to_begin": "Upload streams to begin.",
        "msg.need_two_streams": "Add at least two streams to align.",
        "ui.ref_stream": "Reference stream",
        "ui.tgt_stream": "Target stream",
        "msg.resampled_ok": "Resampled and overlaid on common grid.",
        "msg.estimated_lag": "Estimated lag (target relative to reference): {lag:.3f} s",
        "msg.dtw_ok": "DTW completed. Distance: {dist:.3f}",
        "msg.align_failed": "Alignment failed: {err}",
        "post.no_alignment": "No alignment yet. Please run alignment above.",
        "post.empty_alignment": "Aligned result is empty.",
        "post.time_window": "Time range (s)",
        "post.corr": "Correlation matrix",
        "post.saved_to": "Saved to {path}",
        "post.save_failed": "Save failed: {err}",
        "post.save_block": "Save current streams and overlay",
        "db.connected": "Connected",
        "db.not_connected": "Not connected",
        "db.connected_detail": "Connected via PG_* env vars",
        "db.select_ref": "Reference stream (save timeseries)",
        "db.select_tgt": "Target stream (save timeseries)",
        "db.save_overlay": "Save streams and overlay to database",
        "db.save_ok": "Saved to database.",
        "db.save_failed": "Failed to save to database: {err}",
        "db.need_two_streams": "Please add at least two streams to establish alignment.",
        "db.not_connected_detail": "Database not connected: {err}",
    },
    "简体中文": {
        "app.title": "多模态时序对齐原型系统",
        "sidebar.header": "",
        "sidebar.upload": "上传数据",
        "sidebar.upload_help": "上传文件",
        "sidebar.modality": "模态",
        "sidebar.stream_name": "流名称",
        "sidebar.add_stream": "添加流",
        "sidebar.settings": "设置",
        "sidebar.language": "语言",
        "sidebar.db_status": "数据库状态",
        "streams.title": "数据流",
        "streams.select": "选择数据流",
        "streams.overlay_with": "叠加",
        "align.title": "对齐",
        "align.method": "方法",
        "align.rate": "目标采样率 (Hz)",
        "align.max_lag": "最大时滞 (s)",
        "align.run": "运行对齐",
        "encode.title": "特征提取与编码",
        "encode.encoder": "编码器",
        "encode.new_name": "新流名称",
        "post.title": "结果分析与导出",
        "post.download": "下载对齐CSV",
        "post.save_outputs": "保存到 outputs/",
        "post.save_db": "保存到数据库",
        "lang.switch": "语言",
        "method.resample": "重采样",
        "method.xcorr": "互相关",
        "method.dtw": "DTW",
        "msg.no_adv_enc": "未检测到高级编码器依赖（PyTorch/Transformers）。请安装后重试。",
        "msg.upload_hint": "请上传文件",
        "msg.unsupported_modality": "不支持的模态",
        "msg.added_stream": "已添加 {name}（{modality}），共 {n} 个点",
        "msg.failed_to_load": "加载失败：{err}",
        "msg.need_one_stream_encode": "请先上传至少一个流以进行编码。",
        "msg.select_stream_to_encode": "选择要编码的流",
        "msg.no_encoder_selected": "未选择编码器。",
        "ui.advanced_params": "高级参数",
        "ui.num_channels_list": "num_channels 列表",
        "ui.extract_and_create": "提取特征并生成新流",
        "msg.encoding_success": "已添加编码流 {name}，形状: {shape}",
        "msg.encoding_failed": "编码失败：{err}",
        "msg.upload_streams_to_begin": "请上传数据流开始使用。",
        "msg.need_two_streams": "请至少添加两个流以进行对齐。",
        "ui.ref_stream": "参考流",
        "ui.tgt_stream": "目标流",
        "msg.resampled_ok": "已重采样并叠加在公共时间网格。",
        "msg.estimated_lag": "估计时滞（目标相对参考）：{lag:.3f} 秒",
        "msg.dtw_ok": "DTW 完成。距离：{dist:.3f}",
        "msg.align_failed": "对齐失败：{err}",
        "post.no_alignment": "暂无对齐结果。请先在上方运行对齐。",
        "post.empty_alignment": "对齐结果为空。",
        "post.time_window": "时间范围（秒）",
        "post.corr": "相关性矩阵",
        "post.saved_to": "已保存到 {path}",
        "post.save_failed": "保存失败：{err}",
        "post.save_block": "保存当前流与对齐结果",
        "db.connected": "已连接",
        "db.not_connected": "未连接",
        "db.connected_detail": "已通过 PG_* 环境变量连接",
        "db.select_ref": "参考流（保存 timeseries）",
        "db.select_tgt": "目标流（保存 timeseries）",
        "db.save_overlay": "保存流与对齐 overlay 到数据库",
        "db.save_ok": "数据库保存完成。",
        "db.save_failed": "数据库保存失败：{err}",
        "db.need_two_streams": "请至少在应用中添加两个流以建立对齐关系。",
        "db.not_connected_detail": "未连接数据库：{err}",
    },
}


def t(key: str, lang: str) -> str:
    d: Dict[str, str] = LANGS.get(lang, LANGS["简体中文"])  # 默认中文
    return d.get(key, key)


